db.Customer.aggregate([
  {
    $lookup: {
      from: "Vendor",
      localField: "VendorId",
      foreignField: "_id",
      as: "vendor"
    }
  },
  { $unwind: "$vendor" }, // Unwind the array if VendorId references multiple vendors
  {
    $match: {
      "vendor.Active": true,
      "vendor.Deleted": { $ne: true },
      "vendor.CreatedOnUtc": { $gte: ISODate("2024-01-01") },
      "Approved": true,
      "Active": true,
      "Groups": "654a1f38ad7dfa659116faee"
    }
  },
  {
    $lookup: {
      from: "Product",
      localField: "vendor._id", // Join with VendorId from the previous stage
      foreignField: "VendorId",
      as: "products",
	  "Approved": "true",

    }
  },
  {
    $group: {
      _id: null,
      vendorsWithProducts: {
        $sum: { $cond: [{ $gt: [{ $size: "$products" }, 0] }, 1, 0] }
      },
      vendorsWithoutProducts: {
        $sum: { $cond: [{ $eq: [{ $size: "$products" }, 0] }, 1, 0] }
      }
    }
  }
]);
